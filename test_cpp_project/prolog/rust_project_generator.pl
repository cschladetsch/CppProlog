% Rust Project Generator using Prolog
% Generates comprehensive README.md and project documentation using declarative rules

% ============================================================================
% Project Configuration Templates
% ============================================================================

% Define project templates with their characteristics
project_template(rust_hello_world, Template) :-
    Template = [
        project_name('Hello World Rust Application'),
        description('A template-generated Hello World application demonstrating Prolog-based code generation with Rust'),
        version('0.1.0'),
        language(rust),
        build_system(cargo),
        license('MIT'),
        author('Generated by Rust Generator'),
        repository_url(''),
        documentation_url(''),
        features(['CLI application', 'Template-based generation', 'Prolog integration'])
    ].

project_template(rust_web_api, Template) :-
    Template = [
        project_name('Rust Web API'),
        description('A RESTful web API built with Rust and generated from Prolog templates'),
        version('1.0.0'),
        language(rust),
        build_system(cargo),
        license('MIT'),
        author('Generated by Rust Generator'),
        dependencies(['actix-web', 'serde', 'tokio']),
        features(['RESTful API', 'JSON serialization', 'Async runtime'])
    ].

project_template(rust_cli_tool, Template) :-
    Template = [
        project_name('Rust CLI Tool'),
        description('A command-line tool built with Rust using template generation'),
        version('1.0.0'),
        language(rust),
        build_system(cargo),
        license('MIT'),
        author('Generated by Rust Generator'),
        dependencies(['clap', 'anyhow', 'serde']),
        features(['Command-line interface', 'Error handling', 'Configuration management'])
    ].

project_template(cpp_project, Template) :-
    Template = [
        project_name('C++ Project'),
        description('A C++ project generated using Prolog-based templates'),
        version('1.0.0'),
        language(cpp),
        build_system(cmake),
        license('MIT'),
        author('Generated by Project Generator'),
        dependencies(['CMake', 'GTest']),
        features(['Modern C++', 'Unit testing', 'Cross-platform'])
    ].

project_template(python_project, Template) :-
    Template = [
        project_name('Python Project'),
        description('A Python project generated using Prolog-based templates'),
        version('1.0.0'),
        language(python),
        build_system(setuptools),
        license('MIT'),
        author('Generated by Project Generator'),
        dependencies(['requests', 'pytest']),
        features(['Python 3.8+', 'Package management', 'Testing framework'])
    ].

% ============================================================================
% README.md Generation Rules
% ============================================================================

% Generate comprehensive README.md
generate_readme(ProjectType) :-
    project_template(ProjectType, Template),
    generate_readme_header(Template),
    generate_readme_description(Template),
    generate_readme_features(Template),
    generate_readme_installation(Template),
    generate_readme_usage(Template),
    generate_readme_development(Template),
    generate_readme_contributing(Template),
    generate_readme_license(Template),
    generate_readme_acknowledgments(Template).

% Generate README header
generate_readme_header(Template) :-
    member(project_name(Name), Template),
    member(description(Description), Template),
    member(version(Version), Template),
    write('# '), write(Name), nl,
    nl,
    write('> '), write(Description), nl,
    nl,
    write('[![Version](https://img.shields.io/badge/version-'), write(Version), write('-blue.svg)](https://github.com/your-username/your-repo)'), nl,
    write('[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)'), nl,
    write('[![Generated](https://img.shields.io/badge/generated%20by-Prolog--Rust-orange.svg)](https://github.com/your-username/rust-generator)'), nl,
    nl.

% Generate description section
generate_readme_description(Template) :-
    member(description(Description), Template),
    member(language(Language), Template),
    write('## Description'), nl,
    nl,
    write(Description), nl,
    nl,
    write('This project was generated using a sophisticated template system that combines:'), nl,
    write('- **Prolog** for declarative rule-based generation'), nl,
    write('- **Rust** for the generator implementation'), nl,
    write('- **'), atom_string(Language, LangStr), upcase_atom(LangStr, LangUpper), write(LangUpper), write('** for the target application'), nl,
    nl.

% Generate features section
generate_readme_features(Template) :-
    write('## Features'), nl,
    nl,
    (   member(features(Features), Template)
    ->  generate_feature_list(Features)
    ;   write('- Template-based project generation'), nl,
        write('- Prolog rule-based configuration'), nl,
        write('- Automated build and test setup'), nl
    ),
    nl.

generate_feature_list([]).
generate_feature_list([Feature|Rest]) :-
    write('- '), write(Feature), nl,
    generate_feature_list(Rest).

% Generate installation section
generate_readme_installation(Template) :-
    member(language(Language), Template),
    write('## Installation'), nl,
    nl,
    generate_language_specific_installation(Language),
    nl.

generate_language_specific_installation(rust) :-
    write('### Prerequisites'), nl,
    nl,
    write('- [Rust](https://rustup.rs/) (latest stable version)'), nl,
    write('- [Cargo](https://doc.rust-lang.org/cargo/) (comes with Rust)'), nl,
    nl,
    write('### Build from Source'), nl,
    nl,
    write('```bash'), nl,
    write('# Clone the repository'), nl,
    write('git clone https://github.com/your-username/your-repo.git'), nl,
    write('cd your-repo'), nl,
    nl,
    write('# Build the project'), nl,
    write('cargo build --release'), nl,
    nl,
    write('# Run the application'), nl,
    write('cargo run'), nl,
    write('```'), nl.

generate_language_specific_installation(cpp) :-
    write('### Prerequisites'), nl,
    nl,
    write('- CMake 3.15 or higher'), nl,
    write('- C++17 compatible compiler (GCC 7+, Clang 5+, MSVC 2017+)'), nl,
    nl,
    write('### Build from Source'), nl,
    nl,
    write('```bash'), nl,
    write('# Clone the repository'), nl,
    write('git clone https://github.com/your-username/your-repo.git'), nl,
    write('cd your-repo'), nl,
    nl,
    write('# Build the project'), nl,
    write('mkdir build && cd build'), nl,
    write('cmake ..'), nl,
    write('make -j$(nproc)'), nl,
    write('```'), nl.

generate_language_specific_installation(python) :-
    write('### Prerequisites'), nl,
    nl,
    write('- Python 3.8 or higher'), nl,
    write('- pip (Python package manager)'), nl,
    nl,
    write('### Install from PyPI'), nl,
    nl,
    write('```bash'), nl,
    write('pip install your-package-name'), nl,
    write('```'), nl,
    nl,
    write('### Install from Source'), nl,
    nl,
    write('```bash'), nl,
    write('# Clone the repository'), nl,
    write('git clone https://github.com/your-username/your-repo.git'), nl,
    write('cd your-repo'), nl,
    nl,
    write('# Install dependencies'), nl,
    write('pip install -r requirements.txt'), nl,
    nl,
    write('# Install the package'), nl,
    write('pip install -e .'), nl,
    write('```'), nl.

% Generate usage section
generate_readme_usage(Template) :-
    member(language(Language), Template),
    member(project_name(Name), Template),
    write('## Usage'), nl,
    nl,
    generate_language_specific_usage(Language, Name),
    nl.

generate_language_specific_usage(rust, ProjectName) :-
    write('### Command Line Interface'), nl,
    nl,
    write('```bash'), nl,
    write('# Run the application'), nl,
    write('./target/release/'), 
    atom_chars(ProjectName, Chars),
    replace_spaces_with_underscores(Chars, UnderscoreChars),
    atom_chars(BinaryName, UnderscoreChars),
    downcase_atom(BinaryName, LowerBinaryName),
    write(LowerBinaryName), nl,
    nl,
    write('# Or using cargo'), nl,
    write('cargo run'), nl,
    write('```'), nl,
    nl,
    write('### Interactive Mode'), nl,
    nl,
    write('When you run the application, it will prompt you for input:'), nl,
    nl,
    write('```'), nl,
    write('ðŸ¦€ Hello World from Rust!'), nl,
    write('This application was generated using:'), nl,
    write('  â€¢ CppProlog for rule-based generation'), nl,
    write('  â€¢ Rust for the generator system'), nl,
    write('  â€¢ Prolog knowledge bases for development files'), nl,
    write('Enter your name: Christian'), nl,
    write('Hello, Christian! Welcome to the generated Rust application! ðŸŽ‰'), nl,
    write('```'), nl.

generate_language_specific_usage(cpp, ProjectName) :-
    write('### Running the Application'), nl,
    nl,
    write('```bash'), nl,
    write('# After building, run the executable'), nl,
    write('./build/bin/'), 
    atom_chars(ProjectName, Chars),
    replace_spaces_with_underscores(Chars, UnderscoreChars),
    atom_chars(BinaryName, UnderscoreChars),
    downcase_atom(BinaryName, LowerBinaryName),
    write(LowerBinaryName), nl,
    write('```'), nl.

generate_language_specific_usage(python, _) :-
    write('### Command Line Interface'), nl,
    nl,
    write('```bash'), nl,
    write('# Run the application'), nl,
    write('python -m your_package_name'), nl,
    nl,
    write('# Or if installed globally'), nl,
    write('your-command-name'), nl,
    write('```'), nl.

% Generate development section
generate_readme_development(Template) :-
    member(language(Language), Template),
    write('## Development'), nl,
    nl,
    generate_development_setup(Language),
    generate_testing_info(Language),
    generate_documentation_info(Language),
    nl.

generate_development_setup(rust) :-
    write('### Development Setup'), nl,
    nl,
    write('```bash'), nl,
    write('# Install development dependencies'), nl,
    write('rustup component add clippy rustfmt'), nl,
    nl,
    write('# Format code'), nl,
    write('cargo fmt'), nl,
    nl,
    write('# Run linter'), nl,
    write('cargo clippy'), nl,
    nl,
    write('# Security audit'), nl,
    write('cargo install cargo-audit'), nl,
    write('cargo audit'), nl,
    write('```'), nl,
    nl.

generate_development_setup(cpp) :-
    write('### Development Setup'), nl,
    nl,
    write('```bash'), nl,
    write('# Install development tools'), nl,
    write('sudo apt-get install build-essential cmake git'), nl,
    nl,
    write('# Configure debug build'), nl,
    write('mkdir build-debug && cd build-debug'), nl,
    write('cmake -DCMAKE_BUILD_TYPE=Debug ..'), nl,
    write('make -j$(nproc)'), nl,
    write('```'), nl,
    nl.

generate_development_setup(python) :-
    write('### Development Setup'), nl,
    nl,
    write('```bash'), nl,
    write('# Create virtual environment'), nl,
    write('python -m venv venv'), nl,
    write('source venv/bin/activate  # On Windows: venv\\Scripts\\activate'), nl,
    nl,
    write('# Install development dependencies'), nl,
    write('pip install -r requirements-dev.txt'), nl,
    nl,
    write('# Format code'), nl,
    write('black .'), nl,
    nl,
    write('# Run linter'), nl,
    write('flake8 .'), nl,
    write('```'), nl,
    nl.

generate_testing_info(rust) :-
    write('### Testing'), nl,
    nl,
    write('```bash'), nl,
    write('# Run all tests'), nl,
    write('cargo test'), nl,
    nl,
    write('# Run tests with output'), nl,
    write('cargo test -- --nocapture'), nl,
    nl,
    write('# Run specific test'), nl,
    write('cargo test test_name'), nl,
    write('```'), nl,
    nl.

generate_testing_info(cpp) :-
    write('### Testing'), nl,
    nl,
    write('```bash'), nl,
    write('# Build and run tests'), nl,
    write('cd build && make test'), nl,
    nl,
    write('# Run tests directly'), nl,
    write('./bin/tests'), nl,
    write('```'), nl,
    nl.

generate_testing_info(python) :-
    write('### Testing'), nl,
    nl,
    write('```bash'), nl,
    write('# Run all tests'), nl,
    write('pytest'), nl,
    nl,
    write('# Run tests with coverage'), nl,
    write('pytest --cov=your_package_name'), nl,
    nl,
    write('# Run specific test file'), nl,
    write('pytest tests/test_specific.py'), nl,
    write('```'), nl,
    nl.

generate_documentation_info(rust) :-
    write('### Documentation'), nl,
    nl,
    write('```bash'), nl,
    write('# Generate Rust documentation'), nl,
    write('cargo doc --no-deps --open'), nl,
    nl,
    write('# Generate Doxygen documentation (if Doxyfile present)'), nl,
    write('doxygen'), nl,
    write('```'), nl,
    nl.

generate_documentation_info(cpp) :-
    write('### Documentation'), nl,
    nl,
    write('```bash'), nl,
    write('# Generate Doxygen documentation'), nl,
    write('doxygen Doxyfile'), nl,
    nl,
    write('# View documentation'), nl,
    write('open docs/html/index.html'), nl,
    write('```'), nl,
    nl.

generate_documentation_info(python) :-
    write('### Documentation'), nl,
    nl,
    write('```bash'), nl,
    write('# Generate Sphinx documentation'), nl,
    write('cd docs'), nl,
    write('make html'), nl,
    nl,
    write('# View documentation'), nl,
    write('open _build/html/index.html'), nl,
    write('```'), nl,
    nl.

% Generate contributing section
generate_readme_contributing(Template) :-
    write('## Contributing'), nl,
    nl,
    write('Contributions are welcome! This project was generated using a template system, so please consider:'), nl,
    nl,
    write('1. **Fork** the repository'), nl,
    write('2. **Create** a feature branch (`git checkout -b feature/amazing-feature`)'), nl,
    write('3. **Make** your changes following the existing code style'), nl,
    write('4. **Add** tests for new functionality'), nl,
    write('5. **Commit** your changes (`git commit -m \'Add amazing feature\'`)'), nl,
    write('6. **Push** to the branch (`git push origin feature/amazing-feature`)'), nl,
    write('7. **Open** a Pull Request'), nl,
    nl,
    write('### Code Style'), nl,
    nl,
    member(language(Language), Template),
    generate_code_style_guidelines(Language),
    nl.

generate_code_style_guidelines(rust) :-
    write('- Follow the official Rust style guidelines'), nl,
    write('- Use `cargo fmt` to format code'), nl,
    write('- Use `cargo clippy` for linting'), nl,
    write('- Write comprehensive tests'), nl,
    write('- Document public APIs with doc comments'), nl.

generate_code_style_guidelines(cpp) :-
    write('- Follow modern C++ best practices (C++17+)'), nl,
    write('- Use consistent indentation (4 spaces)'), nl,
    write('- Include appropriate header guards'), nl,
    write('- Write unit tests for new functionality'), nl,
    write('- Document APIs with Doxygen comments'), nl.

generate_code_style_guidelines(python) :-
    write('- Follow PEP 8 style guide'), nl,
    write('- Use `black` for code formatting'), nl,
    write('- Use `flake8` for linting'), nl,
    write('- Write comprehensive tests with pytest'), nl,
    write('- Include type hints where appropriate'), nl.

% Generate license section
generate_readme_license(Template) :-
    write('## License'), nl,
    nl,
    (   member(license(License), Template)
    ->  (   write('This project is licensed under the '), write(License), write(' License - see the [LICENSE](LICENSE) file for details.'), nl
        )
    ;   write('This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.'), nl
    ),
    nl.

% Generate acknowledgments section
generate_readme_acknowledgments(_Template) :-
    write('## Acknowledgments'), nl,
    nl,
    write('- **CppProlog** - The Prolog interpreter used for rule-based generation'), nl,
    write('- **Rust** - The programming language for the generator system'), nl,
    write('- **Template System** - Prolog-based declarative template generation'), nl,
    write('- **Open Source Community** - For providing excellent tools and libraries'), nl,
    nl,
    write('---'), nl,
    nl,
    write('*This README was automatically generated using Prolog-based templates.*'), nl.

% ============================================================================
% Utility Functions
% ============================================================================

% Replace spaces with underscores in character list
replace_spaces_with_underscores([], []).
replace_spaces_with_underscores([' '|Rest], ['_'|NewRest]) :-
    replace_spaces_with_underscores(Rest, NewRest).
replace_spaces_with_underscores([Char|Rest], [Char|NewRest]) :-
    Char \= ' ',
    replace_spaces_with_underscores(Rest, NewRest).

% Generate project structure documentation
generate_project_structure(Language) :-
    write('## Project Structure'), nl,
    nl,
    write('```'), nl,
    generate_directory_structure(Language),
    write('```'), nl,
    nl.

generate_directory_structure(rust) :-
    write('your-project/'), nl,
    write('â”œâ”€â”€ Cargo.toml          # Project configuration and dependencies'), nl,
    write('â”œâ”€â”€ Doxyfile            # Doxygen documentation configuration'), nl,
    write('â”œâ”€â”€ Jenkinsfile         # CI/CD pipeline configuration'), nl,
    write('â”œâ”€â”€ README.md           # Project documentation (this file)'), nl,
    write('â”œâ”€â”€ LICENSE             # License file'), nl,
    write('â”œâ”€â”€ .gitignore          # Git ignore patterns'), nl,
    write('â”œâ”€â”€ src/                # Source code'), nl,
    write('â”‚   â””â”€â”€ main.rs         # Main application entry point'), nl,
    write('â”œâ”€â”€ tests/              # Integration tests'), nl,
    write('â”œâ”€â”€ examples/           # Example code'), nl,
    write('â”œâ”€â”€ docs/               # Generated documentation'), nl,
    write('â””â”€â”€ target/             # Build artifacts (generated)'), nl.

generate_directory_structure(cpp) :-
    write('your-project/'), nl,
    write('â”œâ”€â”€ CMakeLists.txt      # CMake build configuration'), nl,
    write('â”œâ”€â”€ Doxyfile            # Doxygen documentation configuration'), nl,
    write('â”œâ”€â”€ Jenkinsfile         # CI/CD pipeline configuration'), nl,
    write('â”œâ”€â”€ README.md           # Project documentation (this file)'), nl,
    write('â”œâ”€â”€ LICENSE             # License file'), nl,
    write('â”œâ”€â”€ .gitignore          # Git ignore patterns'), nl,
    write('â”œâ”€â”€ src/                # Source code'), nl,
    write('â”‚   â”œâ”€â”€ main.cpp        # Main application entry point'), nl,
    write('â”‚   â””â”€â”€ *.h/*.cpp       # Header and source files'), nl,
    write('â”œâ”€â”€ tests/              # Unit tests'), nl,
    write('â”œâ”€â”€ include/            # Public header files'), nl,
    write('â”œâ”€â”€ docs/               # Generated documentation'), nl,
    write('â””â”€â”€ build/              # Build artifacts (generated)'), nl.

generate_directory_structure(python) :-
    write('your-project/'), nl,
    write('â”œâ”€â”€ setup.py            # Package setup and configuration'), nl,
    write('â”œâ”€â”€ requirements.txt    # Python dependencies'), nl,
    write('â”œâ”€â”€ Jenkinsfile         # CI/CD pipeline configuration'), nl,
    write('â”œâ”€â”€ README.md           # Project documentation (this file)'), nl,
    write('â”œâ”€â”€ LICENSE             # License file'), nl,
    write('â”œâ”€â”€ .gitignore          # Git ignore patterns'), nl,
    write('â”œâ”€â”€ your_package/       # Python package'), nl,
    write('â”‚   â”œâ”€â”€ __init__.py     # Package initialization'), nl,
    write('â”‚   â””â”€â”€ main.py         # Main application module'), nl,
    write('â”œâ”€â”€ tests/              # Unit tests'), nl,
    write('â”œâ”€â”€ docs/               # Documentation source'), nl,
    write('â””â”€â”€ dist/               # Distribution artifacts (generated)'), nl.

% ============================================================================
% Example Queries
% ============================================================================

% To generate a README for a Rust project:
% ?- generate_readme(rust_hello_world).

% To generate a README for a C++ project:
% ?- generate_readme(cpp_project).

% To generate a README for a Python project:
% ?- generate_readme(python_project).