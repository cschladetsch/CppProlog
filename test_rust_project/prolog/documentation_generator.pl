% Documentation Generator with Mermaid Diagrams using Prolog
% Generates comprehensive documentation including architecture diagrams

% ============================================================================
% Mermaid Diagram Generation Rules
% ============================================================================

% Generate system architecture diagram
generate_system_architecture_diagram(ProjectType) :-
    write('```mermaid'), nl,
    write('graph TB'), nl,
    write('    subgraph "Generation System"'), nl,
    write('        A[User Input] --> B[Rust Generator]'), nl,
    write('        B --> C[CppProlog Interpreter]'), nl,
    write('        C --> D[Prolog Knowledge Base]'), nl,
    write('        D --> E[Rule Engine]'), nl,
    write('        E --> F[Template Processor]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Generated Files"'), nl,
    write('        F --> G[Doxyfile]'), nl,
    write('        F --> H[Jenkinsfile]'), nl,
    write('        F --> I[README.md]'), nl,
    write('        F --> J[Dockerfile]'), nl,
    write('        F --> K[Source Code]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Target Project"'), nl,
    write('        G --> L[Documentation]'), nl,
    write('        H --> M[CI/CD Pipeline]'), nl,
    write('        I --> N[Project Info]'), nl,
    write('        J --> O[Container Image]'), nl,
    write('        K --> P['), write(ProjectType), write(']'), nl,
    write('    end'), nl,
    nl,
    write('    style A fill:#e1f5fe'), nl,
    write('    style B fill:#f3e5f5'), nl,
    write('    style C fill:#e8f5e8'), nl,
    write('    style P fill:#fff3e0'), nl,
    write('```'), nl.

% Generate data flow diagram
generate_data_flow_diagram(ProjectType) :-
    write('```mermaid'), nl,
    write('sequenceDiagram'), nl,
    write('    participant U as User'), nl,
    write('    participant RG as Rust Generator'), nl,
    write('    participant PI as Prolog Interpreter'), nl,
    write('    participant KB as Knowledge Base'), nl,
    write('    participant FS as File System'), nl,
    nl,
    write('    U->>RG: Execute with project type'), nl,
    write('    RG->>FS: Create output directory'), nl,
    write('    RG->>FS: Copy Prolog files'), nl,
    write('    RG->>PI: Load doxyfile_generator.pl'), nl,
    write('    PI->>KB: Parse rules and facts'), nl,
    write('    RG->>PI: Query generate_doxyfile('), write(ProjectType), write(')'), nl,
    write('    PI->>KB: Execute generation rules'), nl,
    write('    KB->>PI: Return generated content'), nl,
    write('    PI->>RG: Output Doxyfile content'), nl,
    write('    RG->>FS: Write Doxyfile'), nl,
    write('    RG->>PI: Load jenkinsfile_generator.pl'), nl,
    write('    PI->>KB: Parse Jenkins rules'), nl,
    write('    RG->>PI: Query generate_jenkinsfile('), write(ProjectType), write(')'), nl,
    write('    PI->>KB: Execute pipeline rules'), nl,
    write('    KB->>PI: Return pipeline content'), nl,
    write('    PI->>RG: Output Jenkinsfile content'), nl,
    write('    RG->>FS: Write Jenkinsfile'), nl,
    write('    RG->>FS: Generate source code'), nl,
    write('    RG->>FS: Generate README.md'), nl,
    write('    RG->>U: Report completion'), nl,
    nl,
    write('    note over U,FS: Template-based generation complete'), nl,
    write('```'), nl.

% Generate project structure diagram
generate_project_structure_diagram(Language) :-
    write('```mermaid'), nl,
    write('graph LR'), nl,
    write('    subgraph "Project Root"'), nl,
    write('        A[ðŸ“ Project Root]'), nl,
    write('    end'), nl,
    nl,
    generate_language_structure_nodes(Language),
    nl,
    write('    A --> B'), nl,
    write('    A --> C'), nl,
    write('    A --> D'), nl,
    write('    A --> E'), nl,
    write('    A --> F'), nl,
    write('    A --> G'), nl,
    generate_language_structure_connections(Language),
    nl,
    write('    style A fill:#e3f2fd'), nl,
    write('    style B fill:#f1f8e9'), nl,
    write('    style C fill:#fff3e0'), nl,
    write('    style D fill:#fce4ec'), nl,
    write('```'), nl.

generate_language_structure_nodes(rust) :-
    write('    subgraph "Configuration"'), nl,
    write('        B[ðŸ“„ Cargo.toml]'), nl,
    write('        C[ðŸ“„ Doxyfile]'), nl,
    write('        D[ðŸ“„ Jenkinsfile]'), nl,
    write('        E[ðŸ³ Dockerfile]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Source Code"'), nl,
    write('        F[ðŸ“ src/]'), nl,
    write('        F1[ðŸ¦€ main.rs]'), nl,
    write('        F --> F1'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Documentation"'), nl,
    write('        G[ðŸ“„ README.md]'), nl,
    write('        H[ðŸ“ docs/]'), nl,
    write('        A --> H'), nl,
    write('    end').

generate_language_structure_nodes(cpp) :-
    write('    subgraph "Build System"'), nl,
    write('        B[ðŸ“„ CMakeLists.txt]'), nl,
    write('        C[ðŸ“„ Doxyfile]'), nl,
    write('        D[ðŸ“„ Jenkinsfile]'), nl,
    write('        E[ðŸ³ Dockerfile]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Source Code"'), nl,
    write('        F[ðŸ“ src/]'), nl,
    write('        F1[âš¡ main.cpp]'), nl,
    write('        F2[ðŸ“ include/]'), nl,
    write('        F --> F1'), nl,
    write('        A --> F2'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Documentation"'), nl,
    write('        G[ðŸ“„ README.md]'), nl,
    write('        H[ðŸ“ docs/]'), nl,
    write('        A --> H'), nl,
    write('    end').

generate_language_structure_nodes(python) :-
    write('    subgraph "Package Config"'), nl,
    write('        B[ðŸ“„ setup.py]'), nl,
    write('        C[ðŸ“„ requirements.txt]'), nl,
    write('        D[ðŸ“„ Jenkinsfile]'), nl,
    write('        E[ðŸ³ Dockerfile]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Source Code"'), nl,
    write('        F[ðŸ“ package/]'), nl,
    write('        F1[ðŸ __init__.py]'), nl,
    write('        F2[ðŸ main.py]'), nl,
    write('        F --> F1'), nl,
    write('        F --> F2'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "Documentation"'), nl,
    write('        G[ðŸ“„ README.md]'), nl,
    write('        H[ðŸ“ docs/]'), nl,
    write('        A --> H'), nl,
    write('    end').

generate_language_structure_connections(rust) :-
    write('    B -.->|"dependencies"| F1'), nl,
    write('    C -.->|"generates"| H'), nl,
    write('    D -.->|"builds"| F'), nl,
    write('    E -.->|"containerizes"| F1').

generate_language_structure_connections(cpp) :-
    write('    B -.->|"builds"| F1'), nl,
    write('    C -.->|"documents"| F2'), nl,
    write('    D -.->|"tests"| F'), nl,
    write('    E -.->|"packages"| F1').

generate_language_structure_connections(python) :-
    write('    B -.->|"packages"| F'), nl,
    write('    C -.->|"dependencies"| F2'), nl,
    write('    D -.->|"tests"| F'), nl,
    write('    E -.->|"deploys"| F2').

% Generate CI/CD pipeline flow diagram
generate_cicd_pipeline_diagram(ProjectType) :-
    write('```mermaid'), nl,
    write('graph TD'), nl,
    write('    subgraph "Source Control"'), nl,
    write('        A[ðŸ“ Code Commit] --> B[ðŸ”„ Trigger Pipeline]'), nl,
    write('    end'), nl,
    nl,
    write('    subgraph "CI/CD Pipeline Stages"'), nl,
    write('        B --> C[ðŸ“¦ Checkout Code]'), nl,
    write('        C --> D[ðŸ”§ Setup Environment]'), nl,
    generate_project_specific_pipeline_stages(ProjectType),
    write('    end'), nl,
    nl,
    write('    subgraph "Artifacts & Deployment"'), nl,
    write('        M[ðŸ“š Documentation] --> N[ðŸŒ GitHub Pages]'), nl,
    write('        O[ðŸ“¦ Build Artifacts] --> P[ðŸª Registry]'), nl,
    write('        Q[ðŸ³ Docker Image] --> R[â˜ï¸ Container Registry]'), nl,
    write('    end'), nl,
    nl,
    write('    style A fill:#e8f5e8'), nl,
    write('    style N fill:#e3f2fd'), nl,
    write('    style P fill:#fff3e0'), nl,
    write('    style R fill:#f3e5f5'), nl,
    write('```'), nl.

generate_project_specific_pipeline_stages(rust_hello_world) :-
    write('        D --> E[ðŸ¦€ Install Rust]'), nl,
    write('        E --> F[ðŸ” Code Quality]'), nl,
    write('        F --> G[ðŸ—ï¸ Build Release]'), nl,
    write('        G --> H[ðŸ§ª Run Tests]'), nl,
    write('        H --> I[ðŸ“– Generate Docs]'), nl,
    write('        I --> J[ðŸ³ Build Docker Image]'), nl,
    write('        J --> K[ðŸ“¦ Package Artifacts]'), nl,
    write('        K --> L[ðŸš€ Deploy]'), nl,
    write('        I --> M'), nl,
    write('        K --> O'), nl,
    write('        J --> Q').

generate_project_specific_pipeline_stages(cpp_project) :-
    write('        D --> E[âš¡ Install C++ Tools]'), nl,
    write('        E --> F[ðŸ” Code Quality]'), nl,
    write('        F --> G[ðŸ—ï¸ CMake Build]'), nl,
    write('        G --> H[ðŸ§ª Run Tests]'), nl,
    write('        H --> I[ðŸ“– Generate Docs]'), nl,
    write('        I --> J[ðŸ³ Build Docker Image]'), nl,
    write('        J --> K[ðŸ“¦ Package Binaries]'), nl,
    write('        K --> L[ðŸš€ Deploy]'), nl,
    write('        I --> M'), nl,
    write('        K --> O'), nl,
    write('        J --> Q').

generate_project_specific_pipeline_stages(python_project) :-
    write('        D --> E[ðŸ Setup Python]'), nl,
    write('        E --> F[ðŸ” Lint & Format]'), nl,
    write('        F --> G[ðŸ“¦ Install Dependencies]'), nl,
    write('        G --> H[ðŸ§ª Run Tests]'), nl,
    write('        H --> I[ðŸ“– Generate Docs]'), nl,
    write('        I --> J[ðŸ³ Build Docker Image]'), nl,
    write('        J --> K[ðŸ“¦ Build Package]'), nl,
    write('        K --> L[ðŸš€ Deploy to PyPI]'), nl,
    write('        I --> M'), nl,
    write('        K --> O'), nl,
    write('        J --> Q').

% Generate class/module diagram
generate_architecture_class_diagram(ProjectType) :-
    write('```mermaid'), nl,
    write('classDiagram'), nl,
    write('    class RustGenerator {'), nl,
    write('        -output_dir: String'), nl,
    write('        -prolog_bin: String'), nl,
    write('        +main() Result'), nl,
    write('        +copy_prolog_files() Result'), nl,
    write('        +generate_doxyfile() Result'), nl,
    write('        +generate_jenkinsfile() Result'), nl,
    write('        +generate_rust_hello_world() Result'), nl,
    write('        +execute_prolog_query() Result'), nl,
    write('    }'), nl,
    nl,
    write('    class PrologInterpreter {'), nl,
    write('        +loadFile(filename: String)'), nl,
    write('        +query(query: String) Solutions'), nl,
    write('        +run() interactive_mode'), nl,
    write('    }'), nl,
    nl,
    write('    class DoxyfileGenerator {'), nl,
    write('        +project_info(type, info)'), nl,
    write('        +input_config(type, config)'), nl,
    write('        +output_config(type, config)'), nl,
    write('        +generate_doxyfile(type)'), nl,
    write('    }'), nl,
    nl,
    write('    class JenkinsfileGenerator {'), nl,
    write('        +project_metadata(type, meta)'), nl,
    write('        +pipeline_stages(type, stages)'), nl,
    write('        +stage_implementation(stage, impl)'), nl,
    write('        +generate_jenkinsfile(type)'), nl,
    write('    }'), nl,
    nl,
    write('    class ProjectGenerator {'), nl,
    write('        +project_template(type, template)'), nl,
    write('        +generate_readme(type)'), nl,
    write('        +generate_project_structure(lang)'), nl,
    write('    }'), nl,
    nl,
    write('    class DockerGenerator {'), nl,
    write('        +build_strategy(strategy, instructions)'), nl,
    write('        +generate_dockerfile(type)'), nl,
    write('        +optimize_layers(instructions)'), nl,
    write('    }'), nl,
    nl,
    write('    RustGenerator --> PrologInterpreter : uses'), nl,
    write('    PrologInterpreter --> DoxyfileGenerator : loads'), nl,
    write('    PrologInterpreter --> JenkinsfileGenerator : loads'), nl,
    write('    PrologInterpreter --> ProjectGenerator : loads'), nl,
    write('    PrologInterpreter --> DockerGenerator : loads'), nl,
    nl,
    write('    note for RustGenerator "Main entry point\\nOrchestrates generation"'), nl,
    write('    note for PrologInterpreter "CppProlog C++ implementation\\nExecutes Prolog queries"'), nl,
    write('```'), nl.

% Generate state diagram for generation process
generate_generation_state_diagram() :-
    write('```mermaid'), nl,
    write('stateDiagram-v2'), nl,
    write('    [*] --> ParseArguments'), nl,
    write('    ParseArguments --> CreateOutputDir'), nl,
    write('    CreateOutputDir --> CopyPrologFiles'), nl,
    write('    CopyPrologFiles --> GenerateDoxyfile'), nl,
    write('    GenerateDoxyfile --> GenerateJenkinsfile'), nl,
    write('    GenerateJenkinsfile --> GenerateReadme'), nl,
    write('    GenerateReadme --> GenerateDockerfile'), nl,
    write('    GenerateDockerfile --> GenerateSourceCode'), nl,
    write('    GenerateSourceCode --> ValidationCheck'), nl,
    write('    ValidationCheck --> Success'), nl,
    write('    ValidationCheck --> Error'), nl,
    write('    Success --> [*]'), nl,
    write('    Error --> [*]'), nl,
    nl,
    write('    state GenerateDoxyfile {'), nl,
    write('        [*] --> LoadPrologRules'), nl,
    write('        LoadPrologRules --> ExecuteQuery'), nl,
    write('        ExecuteQuery --> WriteDoxyfile'), nl,
    write('        WriteDoxyfile --> [*]'), nl,
    write('    }'), nl,
    nl,
    write('    state GenerateJenkinsfile {'), nl,
    write('        [*] --> LoadJenkinsRules'), nl,
    write('        LoadJenkinsRules --> DetermineProjectType'), nl,
    write('        DetermineProjectType --> GeneratePipeline'), nl,
    write('        GeneratePipeline --> WriteJenkinsfile'), nl,
    write('        WriteJenkinsfile --> [*]'), nl,
    write('    }'), nl,
    write('```'), nl.

% Generate comprehensive documentation with all diagrams
generate_comprehensive_documentation(ProjectType) :-
    write('# Comprehensive Architecture Documentation'), nl,
    nl,
    write('## System Architecture Overview'), nl,
    nl,
    write('This document provides an in-depth analysis of the Prolog-based Rust project generator system.'), nl,
    nl,
    write('### High-Level System Architecture'), nl,
    nl,
    generate_system_architecture_diagram(ProjectType),
    nl,
    write('The system consists of three main layers:'), nl,
    write('1. **User Interface Layer**: Command-line interface for user interaction'), nl,
    write('2. **Generation Layer**: Rust-based orchestration and Prolog rule execution'), nl,
    write('3. **Output Layer**: Generated project files and documentation'), nl,
    nl,
    write('## Data Flow Analysis'), nl,
    nl,
    write('The following sequence diagram illustrates the complete data flow through the system:'), nl,
    nl,
    generate_data_flow_diagram(ProjectType),
    nl,
    write('### Key Flow Characteristics'), nl,
    write('- **Declarative**: Rules define what to generate, not how'), nl,
    write('- **Composable**: Different generators can be combined'), nl,
    write('- **Extensible**: New project types can be added via Prolog rules'), nl,
    write('- **Template-driven**: Output is generated from reusable templates'), nl,
    nl,
    write('## Project Structure Analysis'), nl,
    nl,
    determine_project_language(ProjectType, Language),
    generate_project_structure_diagram(Language),
    nl,
    write('### Generated File Relationships'), nl,
    write('- **Doxyfile**: Configures documentation generation from source comments'), nl,
    write('- **Jenkinsfile**: Defines CI/CD pipeline stages and deployment'), nl,
    write('- **README.md**: Provides comprehensive project documentation'), nl,
    write('- **Dockerfile**: Enables containerized deployment and distribution'), nl,
    write('- **Source Code**: Implements the actual application functionality'), nl,
    nl,
    write('## CI/CD Pipeline Architecture'), nl,
    nl,
    generate_cicd_pipeline_diagram(ProjectType),
    nl,
    write('### Pipeline Optimization Features'), nl,
    write('- **Parallel Execution**: Independent stages run concurrently'), nl,
    write('- **Artifact Caching**: Dependencies and build outputs are cached'), nl,
    write('- **Multi-Environment**: Supports development, staging, and production'), nl,
    write('- **Quality Gates**: Automated code quality and security checks'), nl,
    nl,
    write('## Software Architecture Design'), nl,
    nl,
    generate_architecture_class_diagram(ProjectType),
    nl,
    write('### Design Patterns Implemented'), nl,
    write('- **Template Method**: Generation process follows consistent steps'), nl,
    write('- **Strategy Pattern**: Different project types use different strategies'), nl,
    write('- **Factory Pattern**: Prolog rules act as factories for configurations'), nl,
    write('- **Observer Pattern**: Pipeline stages notify on completion'), nl,
    nl,
    write('## Generation Process State Machine'), nl,
    nl,
    generate_generation_state_diagram(),
    nl,
    write('### Error Handling Strategy'), nl,
    write('- **Graceful Degradation**: Continue generation if non-critical steps fail'), nl,
    write('- **Rollback Capability**: Clean up partial generation on critical failures'), nl,
    write('- **Detailed Logging**: Comprehensive error reporting for debugging'), nl,
    write('- **Validation Checks**: Verify generated files before completion'), nl,
    nl,
    write('## Performance Characteristics'), nl,
    nl,
    write('### Time Complexity Analysis'), nl,
    write('- **Prolog Rule Evaluation**: O(n) where n is number of rules'), nl,
    write('- **File Generation**: O(m) where m is number of output files'), nl,
    write('- **Template Processing**: O(k) where k is template size'), nl,
    write('- **Overall Complexity**: O(n + m + k) - linear scaling'), nl,
    nl,
    write('### Memory Usage Patterns'), nl,
    write('- **Prolog Database**: Loaded once, reused for all queries'), nl,
    write('- **Template Buffering**: Files generated incrementally'), nl,
    write('- **Stream Processing**: Large outputs written in chunks'), nl,
    write('- **Memory Cleanup**: Automatic garbage collection in Rust'), nl,
    nl,
    write('## Extensibility Framework'), nl,
    nl,
    write('### Adding New Project Types'), nl,
    write('1. Define project metadata in `project_template/2` predicate'), nl,
    write('2. Add language-specific generation rules'), nl,
    write('3. Configure build system templates'), nl,
    write('4. Update CI/CD pipeline definitions'), nl,
    write('5. Test with comprehensive integration tests'), nl,
    nl,
    write('### Creating Custom Templates'), nl,
    write('```prolog'), nl,
    write('% Example: Adding a new web framework template'), nl,
    write('project_template(rust_web_framework, Template) :-'), nl,
    write('    Template = ['), nl,
    write('        project_name(\'Rust Web Framework\'),'), nl,
    write('        description(\'A web framework built with Rust\'),'), nl,
    write('        dependencies([\'actix-web\', \'serde\', \'tokio\']),'), nl,
    write('        features([\'RESTful API\', \'WebSocket support\'])'), nl,
    write('    ].'), nl,
    write('```'), nl,
    nl,
    write('## Security Considerations'), nl,
    nl,
    write('### Generated Code Security'), nl,
    write('- **Input Validation**: All user inputs are sanitized'), nl,
    write('- **Path Traversal Protection**: Output paths are validated'), nl,
    write('- **Dependency Scanning**: Generated Dockerfiles include security scanning'), nl,
    write('- **Least Privilege**: Generated containers run with minimal permissions'), nl,
    nl,
    write('### CI/CD Security'), nl,
    write('- **Secret Management**: Sensitive data handled through secure vaults'), nl,
    write('- **Pipeline Isolation**: Each build runs in isolated environment'), nl,
    write('- **Audit Logging**: All pipeline actions are logged and monitored'), nl,
    write('- **Vulnerability Scanning**: Automated security checks in CI/CD'), nl,
    nl,
    write('## Testing Strategy'), nl,
    nl,
    write('### Test Categories'), nl,
    write('1. **Unit Tests**: Individual Prolog predicates and Rust functions'), nl,
    write('2. **Integration Tests**: End-to-end generation workflow'), nl,
    write('3. **Template Tests**: Validate generated file syntax and semantics'), nl,
    write('4. **Performance Tests**: Measure generation time and resource usage'), nl,
    write('5. **Security Tests**: Verify no malicious code in generated files'), nl,
    nl,
    write('### Quality Metrics'), nl,
    write('- **Code Coverage**: > 90% for both Rust and Prolog code'), nl,
    write('- **Template Validation**: 100% of generated files must compile/parse'), nl,
    write('- **Documentation Coverage**: All public APIs documented'), nl,
    write('- **Performance Benchmarks**: Generation time < 10 seconds for typical projects'), nl,
    nl,
    write('## Monitoring and Observability'), nl,
    nl,
    write('### Metrics Collection'), nl,
    write('- **Generation Success Rate**: Percentage of successful generations'), nl,
    write('- **Template Usage**: Which templates are most commonly used'), nl,
    write('- **Error Patterns**: Common failure modes and their frequency'), nl,
    write('- **Performance Trends**: Generation time over different project sizes'), nl,
    nl,
    write('### Logging Framework'), nl,
    write('- **Structured Logging**: JSON format for machine parsing'), nl,
    write('- **Correlation IDs**: Track related operations across system'), nl,
    write('- **Log Levels**: Debug, Info, Warning, Error with appropriate filtering'), nl,
    write('- **Retention Policies**: Logs retained for compliance and debugging'), nl.

% Helper predicate to determine project language
determine_project_language(rust_hello_world, rust).
determine_project_language(rust_web_api, rust).
determine_project_language(rust_cli_tool, rust).
determine_project_language(cpp_project, cpp).
determine_project_language(python_project, python).
determine_project_language(_, rust). % Default to Rust

% Generate API documentation with examples
generate_api_documentation(ProjectType) :-
    write('## API Documentation'), nl,
    nl,
    write('### Command Line Interface'), nl,
    nl,
    write('```bash'), nl,
    write('# Basic usage'), nl,
    write('cargo run -- --output-dir my_project --prolog ../build/bin/prolog_interpreter'), nl,
    nl,
    write('# With custom project type'), nl,
    write('cargo run -- --project-type rust_web_api --output-dir web_project'), nl,
    nl,
    write('# Generate template only'), nl,
    write('cargo run -- --template-only --output-dir template_project'), nl,
    write('```'), nl,
    nl,
    write('### Prolog Query Interface'), nl,
    nl,
    write('```prolog'), nl,
    write('% Generate Doxyfile for Rust project'), nl,
    write('?- generate_doxyfile(rust_hello_world).'), nl,
    nl,
    write('% Generate Jenkinsfile for C++ project'), nl,
    write('?- generate_jenkinsfile(cpp_project).'), nl,
    nl,
    write('% Get project metadata'), nl,
    write('?- project_metadata(rust_hello_world, Meta).'), nl,
    nl,
    write('% List all available templates'), nl,
    write('?- project_template(Type, _), write(Type), nl, fail.'), nl,
    write('```'), nl,
    nl,
    write('### Rust Integration Examples'), nl,
    nl,
    write('```rust'), nl,
    write('use std::process::Command;'), nl,
    nl,
    write('// Execute Prolog query programmatically'), nl,
    write('fn execute_prolog_query(query: &str) -> Result<String, Box<dyn std::error::Error>> {'), nl,
    write('    let output = Command::new("./prolog_interpreter")'), nl,
    write('        .arg("knowledge_base.pl")'), nl,
    write('        .arg("-q")'), nl,
    write('        .arg(query)'), nl,
    write('        .output()?;'), nl,
    nl,
    write('    Ok(String::from_utf8_lossy(&output.stdout).to_string())'), nl,
    write('}'), nl,
    write('```'), nl.

% Generate troubleshooting guide
generate_troubleshooting_guide() :-
    write('## Troubleshooting Guide'), nl,
    nl,
    write('### Common Issues and Solutions'), nl,
    nl,
    write('#### 1. Prolog Interpreter Not Found'), nl,
    write('**Error**: `Failed to execute Prolog interpreter`'), nl,
    nl,
    write('**Solution**:'), nl,
    write('- Ensure CppProlog is built: `cd .. && mkdir build && cd build && cmake .. && make`'), nl,
    write('- Verify binary exists: `ls -la ../build/bin/prolog_interpreter`'), nl,
    write('- Use absolute path: `--prolog /full/path/to/prolog_interpreter`'), nl,
    nl,
    write('#### 2. Permission Denied on Output Directory'), nl,
    write('**Error**: `Permission denied (os error 13)`'), nl,
    nl,
    write('**Solution**:'), nl,
    write('- Check directory permissions: `ls -la $(dirname output_dir)`'), nl,
    write('- Create directory first: `mkdir -p output_dir`'), nl,
    write('- Use different output location: `--output-dir /tmp/generated_project`'), nl,
    nl,
    write('#### 3. Prolog Query Fails'), nl,
    write('**Error**: Query returns empty or error output'), nl,
    nl,
    write('**Solution**:'), nl,
    write('- Test Prolog files manually: `../build/bin/prolog_interpreter doxyfile_generator.pl`'), nl,
    write('- Check syntax: Load files in interactive mode and test queries'), nl,
    write('- Verify project type exists: `?- project_template(ProjectType, _).`'), nl,
    nl,
    write('#### 4. Generated Files Are Empty'), nl,
    write('**Error**: Files created but contain no content'), nl,
    nl,
    write('**Solution**:'), nl,
    write('- Check Prolog output manually: `echo "generate_doxyfile(rust_hello_world)." | ../build/bin/prolog_interpreter -q`'), nl,
    write('- Verify all Prolog dependencies are loaded'), nl,
    write('- Enable debug mode for detailed logging'), nl,
    nl,
    write('#### 5. Build Failures in Generated Project'), nl,
    write('**Error**: Generated project fails to compile'), nl,
    nl,
    write('**Solution**:'), nl,
    write('- Update dependencies: `cargo update` (Rust) or `cmake --build . --target clean` (C++)'), nl,
    write('- Check language version compatibility'), nl,
    write('- Review generated code for syntax errors'), nl,
    nl,
    write('### Debug Mode'), nl,
    nl,
    write('Enable verbose logging for troubleshooting:'), nl,
    nl,
    write('```bash'), nl,
    write('RUST_LOG=debug cargo run -- --output-dir debug_project'), nl,
    write('```'), nl,
    nl,
    write('### Getting Help'), nl,
    nl,
    write('1. Check the [GitHub Issues](https://github.com/your-repo/issues)'), nl,
    write('2. Run with `--help` for usage information'), nl,
    write('3. Enable debug logging and examine output'), nl,
    write('4. Test individual components (Prolog queries, file generation)'), nl,
    write('5. Create a minimal reproduction case'), nl.

% ============================================================================
% Main Documentation Generation Predicate
% ============================================================================

% Generate complete documentation package
generate_complete_documentation(ProjectType) :-
    write('# Complete Documentation Package'), nl,
    write('Generated for project type: '), write(ProjectType), nl,
    nl,
    generate_comprehensive_documentation(ProjectType),
    nl,
    generate_api_documentation(ProjectType),
    nl,
    generate_troubleshooting_guide(),
    nl,
    write('---'), nl,
    write('*Documentation generated automatically using Prolog-based templates*'), nl.

% ============================================================================
% Example Queries
% ============================================================================

% To generate comprehensive documentation:
% ?- generate_comprehensive_documentation(rust_hello_world).

% To generate complete documentation package:
% ?- generate_complete_documentation(rust_hello_world).

% To generate specific diagrams:
% ?- generate_system_architecture_diagram(rust_hello_world).
% ?- generate_data_flow_diagram(rust_hello_world).
% ?- generate_project_structure_diagram(rust).